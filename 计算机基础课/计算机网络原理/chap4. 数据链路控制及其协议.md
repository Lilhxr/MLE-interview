# 数据链路控制及其协议

### 1. 定义和功能

#### 1.1 定义

要解决的问题：如何**在有差错的线路上，进行无差错传输**。

数据链路：从数据**发送点**到数据**接收点**所经过的传输途径。有虚拟数据通路和实际数据通路。

![img](https://pic1.zhimg.com/80/v2-027db9d25e78d444ea1c7c4a8314eb21_1440w.png)

#### 1.2 为网络层提供服务
为**网络层**提供三种合理的服务

- 无确认无连接服务。适用于：
  - 误码率很低的线路，错误恢复留给高层；
  - 实时业务
  - 大部分局域网

-  有确认无连接服务：适用于不可靠的信道，如无线网。
- 有确认有连接服务

#### 1.3 成帧（Framing）
将比特流分成离散的帧，并计算每个帧的校验和。
成帧方法：

- 字符计数法

  - 在帧头中用一个**域**来表示整个帧的字符个数
  - 缺点：若计数出错，对本帧和后面的帧有影响。

  ![img](https://pic2.zhimg.com/80/v2-5a9b8e21ca49098eab3fc86ccafc11d7_1440w.jpeg)

- 带字符填充的首尾字符定界法

  - 起始字符 DLE STX，结束字符DLE ETX。其中DLE是”转义“字符
  - 缺点：局限于8位字符和ASCII字符传送。

  ![img](https://pic3.zhimg.com/80/v2-7727611e0ab7b18564877d6806cb8e01_1440w.jpeg)

- 带位填充的首尾标记定界法
  - 帧的起始和结束都用一个特殊的位串“01111110”，称为标记
  - “0”比特插入删除技术

![img](https://pica.zhimg.com/80/v2-dcf6a9b80c7e2c164bf3f2d357b71567_1440w.jpeg)

- 物理层编码违例法
  - 只适用于物理层编码有冗余的网络（使用不可能出现的编码来做定界符）

### 2 错误检测和纠正
差错出现的特点：随机，连续突发（burst）
处理差错的两种基本策略
• 使用**纠错**码：发送方在每个数据块中加入足够的**冗余信息**，使得接收方能够判断接收到的数据是否有错，并**能纠正错误**。
• 使用检错码：发送方在每个数据块中加入足够的冗余信息，使得接收方能够判断接收到的数据是否有错，但**不能判断哪里有错**。最简单的例子是奇偶校验，在数据后填加一个奇偶位，”1“的个数为偶数。奇偶校验可以用来检查奇数个错误。

使用纠错码传数据，效率低，适用于不可能重传的场合；大多数情况采用**检错码加重传**。

经典的检错码：循环冗余码（CRC码，多项式编码）。如110001，表示成多项式 $x^5 + x^4 + 1$. 这个生成多项式G(x)由发方、收方事前商定；CRC码基本思想：校验和加在帧尾，使带校验和（checksum）的帧的多项式能被G(x)除尽；收方接收时，用G(x)去除它，**若有余数，则传输出错**。

### 3.基本的数据链路层协议

#### 3.1 无约束单工协议（An Unrestricted Simplex Protocol）
– 工作在理想情况，几个前提：

- 单工传输
- 发送方无休止工作（要发送的信息无限多）
- 接收方无休止工作（**缓冲区无限大**）
- 通信线路（信道）不损坏或丢失信息

– 工作过程
• 发送程序 :取数据，构成帧，发送帧；
• 接收程序：等待，接收帧，送数据给高层

![img](https://pica.zhimg.com/80/v2-a0cf437c96a3776a046f15d81757ca89_1440w.jpeg)

#### 3.2 单工停等协议（A Simplex Stop-and-Wait Protocol）
– 增加约束条件：接收方**不能无休止接收**。（接收方的缓冲区有限）
– 解决办法：接收方每收到一个帧后，给发送方回送一个响应（告诉发送方可以再发了）。
– 工作过程
• 发送程序：取数据，成帧，发送帧，**等待响应帧**；
• 接收程序：等待，接收帧，送数据给高层，**回送响应帧**。

![img](https://pic2.zhimg.com/80/v2-41a28bf0f662dd859b6ca4afa3c9ef30_1440w.jpeg)

#### 3.3 有噪声信道的单工协议（A Simplex Protocol for a Noisy Channel）
– 增加约束条件：信道（线路）**有差错**，信息帧可能损坏或丢失。
– 解决办法：**出错重传**。如果正确到达，则接受方发送相应帧；如果错误/丢失，则等待超时重传。

-问题：

- 响应帧损坏怎么办？如果相应帧损坏，发送方会认为接收方没有收到，然后再发一次。这样接收方就会收到重复帧。解决方法—— 发送帧头中放入序号，只有接收方接收到想要的序号时才会处理收到的帧。通过计时器和序号保证每帧最终交给目的网络层**仅一次**是数据链路层的一个主要功能。
- 为了使帧头精简，序号取多少位 —— 1位

这种发送方在发下一个帧之前等待一个肯定**确认**的协议叫做PAR（Positive Acknowledgement with Retransmission）

![img](https://pic1.zhimg.com/80/v2-b17d5fa475d89a70119b94021a19f0a6_1440w.jpeg)

