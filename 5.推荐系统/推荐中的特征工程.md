# 推荐中的特征工程

**搜索场景**，用户意图是主动明确的，目标是更快找到需要的物品；**推荐场景**用户的兴趣是模糊的，目标是推荐给他多样的、准确的（这两个目标是个trade-off）的物品。

例如，在搜索场景，由于Prefix或Query的限制，召回的物品得满足相关性，一些向量召回方法就不易发挥用处。另一方面，推荐系统不同阶段的特点对特征和模型也有所限制，例如，**召回阶段**面对的是海量的候选集，只能上简单的特征和模型粗略选出用户可能会感兴趣的物品，而**排序阶段**的候选集的规模较小，可以上复杂的特征和模型更精确地预估用户对物品的感兴趣程度。



## 1. 序列

- **1.1 行为类型**：点击，收藏，成交是不同的interaction种类，可以分别表示用户的短期，中期，长期兴趣，既可以组织为一个混合序列、并通过interaction类别特征进行区分（Perceive Your Users in Depth: Learning Universal User Representations from Multiple E-commerce Tasks https://arxiv.org/abs/1805.10727），也可以直接组织为多个种类的序列分别建模 -- 用户对近期点击过的商品大概率仍然感兴趣，但对于近期购买过的商品一般短期内不再感兴趣（需求已被满足）。

- **1.2 行为时间**

- - 该行为距离当前query的时间差。一般来说，用户当前的兴趣与近期行为过的物品更相关。
  - 在当前物品上的停留时间。例如，用户在购买某一商品时在详情页的停留时间，停留时间越长一般越感兴趣。

- **1.3 行为场景**：对一个商品的点击可以发生在首页推荐，搜索推荐和广告推荐[1]，同一种行为在不同场景下含有不同的意义。

- **1.4 物品种类**：行为序列中的物品可以是Query，Item，Review，Music，Movie，Book，Food等，视业务场景而定。

- **1.5 物品属性**：如果只使用物品ID特征，长尾物品在样本和序列中占比都很低，其ID Embedding不容易学好，因此可以加入类目，品牌，店铺等**泛化特征**[1]，同时模型也能学习到更泛化的偏好，例如某一用户更喜欢购买阿迪达斯品牌的商品。

- **1.6 序列划分**

- - **多种兴趣**：用序列模型抽取行为序列信息得到用户的兴趣向量，考虑到序列内物品的异构性，单一的兴趣向量难以精确地表征用户的兴趣偏好，例如，某个用户的行为序列内既有服饰类商品又有电子类商品，将对不同类目商品的兴趣融合到一个向量内容易导致“四不像”。一个典型的例子是推荐场景的召回阶段，单一的兴趣向量召回的商品往往比较杂甚至不相关。因此，我们可以对行为序列进行划分，一方面，可以根据某个准则**手动划分**，例如，根据**类目特征**将商品分类、根据**时间窗口划分Session**（同一Session内的物品更相关）；另一方面，也可以使用**胶囊网络（MIND）**，**记忆单元（MIMN）**等动态学习兴趣划分。事实上，**Multi-head Attention**也能学习到这样的多种兴趣。
  - **长短兴趣**：根据时间跨度可以将序列划分为短期序列和长期序列，分别用来表征用户的短期兴趣和长期兴趣（相对稳定）。一方面，**可以设置一个时间窗口划分长短期序列分别学习再做融合**[9,10]，另一方面，**也可以用记忆网络来学习长期兴趣**。一般来说，用户当前的行为主要受短期兴趣的影响。

- **1.7 超长序列**：加长序列可以引入更丰富的用户历史行为，但是序列模型在处理时计算量大且RT高。因此，一方面，**可以根据某个规则快速筛选出超长序列中与Target相关的物品**，例如，同一类目下的物品、Embedding接近的物品（LSH）等[12]，另一方面，**可以合理设计网络结构并利用记忆网络学习**，将兴趣向量的更新与候选物品的打分解耦（MIMN）。